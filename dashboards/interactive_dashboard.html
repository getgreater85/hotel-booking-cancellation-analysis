<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Booking Cancellation Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        h1 {
            color: #2c3e50;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: 140px;
        }
        
        .metric-card.blue { border-top: 4px solid #3498db; }
        .metric-card.red { border-top: 4px solid #e74c3c; }
        .metric-card.green { border-top: 4px solid #2ecc71; }
        .metric-card.orange { border-top: 4px solid #f39c12; }
        
        .metric-title {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .metric-value.blue { color: #3498db; }
        .metric-value.red { color: #e74c3c; }
        .metric-value.green { color: #2ecc71; }
        .metric-value.orange { color: #f39c12; }
        
        .metric-subtitle {
            font-size: 12px;
            color: #95a5a6;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .chart-desc {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: white;
            color: #2c3e50;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .insights-box {
            background: #ecf0f1;
            border-left: 4px solid #e74c3c;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
        }
        
        .insights-box h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .insights-box p {
            color: #7f8c8d;
            margin-bottom: 8px;
        }
        
        .impact {
            color: #27ae60;
            font-weight: bold;
            font-size: 14px;
        }
        
        .footer {
            margin-top: 32px;
            padding: 24px;
            background: rgba(255,255,255,0.9);
            border-radius: 12px;
            text-align: center;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè® Hotel Booking Cancellation Dashboard</h1>
            <p class="subtitle">Interactive Analysis & Business Insights</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">üìä Overview</button>
            <button class="tab" onclick="showTab('drivers')">üéØ Key Drivers</button>
            <button class="tab" onclick="showTab('temporal')">üìÖ Time Trends</button>
            <button class="tab" onclick="showTab('insights')">üí° Insights</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <!-- Metrics -->
            <div class="metrics-grid">
                <div class="metric-card blue">
                    <div class="metric-title">üìä Total Bookings</div>
                    <div class="metric-value blue">36,274</div>
                    <div class="metric-subtitle">Dataset size</div>
                </div>
                <div class="metric-card red">
                    <div class="metric-title">‚ùå Cancellation Rate</div>
                    <div class="metric-value red">32.76%</div>
                    <div class="metric-subtitle">11,885 canceled bookings</div>
                </div>
                <div class="metric-card green">
                    <div class="metric-title">üí∞ Average Price</div>
                    <div class="metric-value green">$103.37</div>
                    <div class="metric-subtitle">Per room</div>
                </div>
                <div class="metric-card orange">
                    <div class="metric-title">‚ö†Ô∏è Revenue at Risk</div>
                    <div class="metric-value orange">$4.22M</div>
                    <div class="metric-subtitle">38.1% of potential</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="chart-container">
                <h3 class="chart-title">Booking Status Distribution</h3>
                <div id="pieChart" style="height: 400px;"></div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">Cancellation Rate by Season</h3>
                <div id="seasonChart" style="height: 400px;"></div>
            </div>
        </div>

        <!-- Drivers Tab -->
        <div id="drivers" class="tab-content">
            <div class="chart-container">
                <h3 class="chart-title">üéØ Driver #1: Lead Time Impact (Correlation: 0.44)</h3>
                <p class="chart-desc">‚ö° Key Finding: Bookings made 365+ days in advance have 59.8% cancellation rate</p>
                <div id="leadTimeChart" style="height: 400px;"></div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">üéØ Driver #2: Market Segment Performance</h3>
                <p class="chart-desc">‚ö° Key Finding: Corporate bookings have only 10.6% cancellation (most reliable!)</p>
                <div id="segmentChart" style="height: 400px;"></div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">üéØ Driver #3: Special Requests (Protective Factor!)</h3>
                <p class="chart-desc">‚ö° Key Finding: Guests with special requests are 2.5x more committed</p>
                <div id="requestsChart" style="height: 400px;"></div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">üéØ Driver #4: Price Category Impact</h3>
                <p class="chart-desc">‚ö° Key Finding: Premium rooms ($125-150) have 41.4% cancellation rate</p>
                <div id="priceChart" style="height: 400px;"></div>
            </div>
        </div>

        <!-- Temporal Tab -->
        <div id="temporal" class="tab-content">
            <div class="chart-container">
                <h3 class="chart-title">üìÖ Monthly Cancellation Trends</h3>
                <p class="chart-desc">Peak season (summer) shows highest cancellation rates</p>
                <div id="monthlyChart" style="height: 400px;"></div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">üìä Bookings vs Cancellations by Month</h3>
                <div id="monthlyStackedChart" style="height: 400px;"></div>
            </div>
        </div>

        <!-- Insights Tab -->
        <div id="insights" class="tab-content">
            <div class="chart-container">
                <h3 class="chart-title">üî¥ HIGH PRIORITY Recommendations</h3>
                
                <div class="insights-box">
                    <h4>1. Implement Deposit Policy</h4>
                    <p>Require deposits for bookings >90 days lead time</p>
                    <div class="impact">üí∞ Impact: $150K-200K annual savings</div>
                </div>

                <div class="insights-box">
                    <h4>2. Encourage Special Requests</h4>
                    <p>Add prominent UI prompts during booking</p>
                    <div class="impact">üí∞ Impact: 10-15% cancellation reduction</div>
                </div>

                <div class="insights-box">
                    <h4>3. Dynamic Cancellation Policies</h4>
                    <p>Stricter policies for summer, flexible for winter</p>
                    <div class="impact">üí∞ Impact: 5-10% seasonal improvement</div>
                </div>

                <div class="insights-box">
                    <h4>4. Re-engagement Campaigns</h4>
                    <p>Automated emails at 60/30/14 days before arrival</p>
                    <div class="impact">üí∞ Impact: 5-8% cancellation reduction</div>
                </div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">üí∞ Revenue Impact Analysis</h3>
                <div id="revenueChart" style="height: 400px;"></div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">üí° Key Business Insights</h3>
                <ul style="line-height: 1.8; color: #34495e; padding-left: 24px;">
                    <li><strong>Lead Time is #1 Driver:</strong> Each 30-day increase in lead time raises cancellation risk by 5-10%</li>
                    <li><strong>Special Requests = Commitment:</strong> Guests making requests are 2.5x more likely to show up</li>
                    <li><strong>Corporate Segment Gold:</strong> Only 10.6% cancellation vs 36.6% for online bookings</li>
                    <li><strong>Summer Challenge:</strong> 40.6% cancellation in summer vs 14.9% in winter</li>
                    <li><strong>Premium Pricing Issue:</strong> Luxury rooms have 49.2% cancellation - needs strategy review</li>
                    <li><strong>Quick Win Available:</strong> Implementing 4 high-priority actions could recover $400K-600K annually</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>üìä Interactive Dashboard | Hotel Booking Cancellation Analysis | Dataset: 36,274 bookings</p>
            <p style="margin-top: 8px; font-size: 12px;">Built with Plotly | Professional Data Analysis | December 2025</p>
        </div>
    </div>

    <!-- Load Plotly with fallback CDNs -->
    <script>
        // Try multiple CDN sources for Plotly
        (function loadPlotly() {
            const cdnUrls = [
                'https://cdn.plot.ly/plotly-2.27.0.min.js',
                'https://cdn.jsdelivr.net/npm/plotly.js-dist@2.27.0/plotly.min.js',
                'https://unpkg.com/plotly.js-dist@2.27.0/plotly.min.js'
            ];
            
            let currentCDN = 0;
            
            function tryLoadScript() {
                if (currentCDN >= cdnUrls.length) {
                    console.error('‚ùå Failed to load Plotly from all CDN sources. Please check your internet connection.');
                    document.getElementById('overview').innerHTML = '<div style="padding:40px;background:white;border-radius:12px;text-align:center;color:#e74c3c;"><h2>‚ö†Ô∏è Unable to Load Charts</h2><p>Plotly library failed to load. Please check your internet connection and refresh the page.</p></div>';
                    return;
                }
                
                const script = document.createElement('script');
                script.src = cdnUrls[currentCDN];
                script.async = false;
                
                script.onload = function() {
                    console.log('‚úÖ Plotly loaded successfully from:', cdnUrls[currentCDN]);
                    // Plotly loaded, the initDashboard function will handle the rest
                };
                
                script.onerror = function() {
                    console.warn('‚ö†Ô∏è Failed to load from:', cdnUrls[currentCDN]);
                    currentCDN++;
                    tryLoadScript();
                };
                
                document.head.appendChild(script);
            }
            
            tryLoadScript();
        })();
    </script>

    <script>
        // Tab switching function (globally accessible)
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Initialize dashboard when ready
        let initAttempts = 0;
        const maxAttempts = 50; // 5 seconds max wait time
        
        function initDashboard() {
            // Check if Plotly is loaded
            if (typeof Plotly === 'undefined') {
                initAttempts++;
                
                if (initAttempts >= maxAttempts) {
                    console.error('‚ùå Plotly failed to load after 5 seconds. Giving up.');
                    document.getElementById('overview').innerHTML = '<div style="padding:40px;background:white;border-radius:12px;text-align:center;color:#e74c3c;"><h2>‚ö†Ô∏è Charts Failed to Load</h2><p>The Plotly library could not be loaded. Please refresh the page or check your internet connection.</p><button onclick="location.reload()" style="margin-top:20px;padding:10px 20px;background:#3498db;color:white;border:none;border-radius:8px;cursor:pointer;font-size:16px;">üîÑ Reload Page</button></div>';
                    return;
                }
                
                if (initAttempts === 1) {
                    console.log('‚è≥ Waiting for Plotly to load...');
                } else if (initAttempts % 10 === 0) {
                    console.log(`‚è≥ Still waiting... (${initAttempts * 100}ms elapsed)`);
                }
                
                setTimeout(initDashboard, 100);
                return;
            }

            console.log('‚úÖ Plotly loaded successfully. Initializing charts...');

            // Pie Chart
            var pieData = [{
                values: [24389, 11885],
                labels: ['Not Canceled', 'Canceled'],
                type: 'pie',
                marker: {
                    colors: ['#2ecc71', '#e74c3c']
                },
                textinfo: 'label+percent',
                textposition: 'inside',
                hoverinfo: 'label+value+percent'
            }];

            var pieLayout = {
                showlegend: true,
                height: 400,
                margin: { t: 30, b: 30, l: 30, r: 30 }
            };

            Plotly.newPlot('pieChart', pieData, pieLayout, {responsive: true});

            // Season Chart
            var seasonData = [{
                x: ['Winter', 'Spring', 'Summer', 'Fall'],
                y: [14.9, 34.5, 40.6, 33.3],
                type: 'bar',
                marker: {
                    color: '#9b59b6'
                },
                text: ['14.9%', '34.5%', '40.6%', '33.3%'],
                textposition: 'outside'
            }];

            var seasonLayout = {
                yaxis: { title: 'Cancellation Rate (%)' },
                height: 400,
                margin: { t: 30, b: 60, l: 60, r: 30 }
            };

            Plotly.newPlot('seasonChart', seasonData, seasonLayout, {responsive: true});

            // Lead Time Chart
            var leadTimeData = [{
                x: ['0-30 days', '31-90 days', '91-180 days', '181-365 days', '365+ days'],
                y: [14.9, 28.5, 42.1, 51.3, 59.8],
                type: 'bar',
                marker: {
                    color: '#e74c3c'
                },
                text: ['14.9%', '28.5%', '42.1%', '51.3%', '59.8%'],
                textposition: 'outside'
            }];

            var leadTimeLayout = {
                yaxis: { title: 'Cancellation Rate (%)' },
                height: 400,
                margin: { t: 30, b: 100, l: 60, r: 30 }
            };

            Plotly.newPlot('leadTimeChart', leadTimeData, leadTimeLayout, {responsive: true});

            // Market Segment Chart
            var segmentData = [{
                y: ['Complementary', 'Corporate', 'Aviation', 'Offline', 'Unknown', 'Online'],
                x: [0.0, 10.6, 29.5, 30.0, 31.5, 36.6],
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: '#3498db'
                },
                text: ['0.0%', '10.6%', '29.5%', '30.0%', '31.5%', '36.6%'],
                textposition: 'outside'
            }];

            var segmentLayout = {
                xaxis: { title: 'Cancellation Rate (%)' },
                height: 400,
                margin: { t: 30, b: 60, l: 120, r: 60 }
            };

            Plotly.newPlot('segmentChart', segmentData, segmentLayout, {responsive: true});

            // Special Requests Chart
            var requestsData = [{
                x: [0, 1, 2, 3, 4, 5],
                y: [42.7, 19.3, 15.8, 12.1, 8.5, 6.2],
                type: 'scatter',
                mode: 'lines+markers',
                marker: {
                    color: '#2ecc71',
                    size: 10
                },
                line: {
                    color: '#2ecc71',
                    width: 3
                }
            }];

            var requestsLayout = {
                xaxis: { title: 'Number of Special Requests' },
                yaxis: { title: 'Cancellation Rate (%)' },
                height: 400,
                margin: { t: 30, b: 60, l: 60, r: 30 }
            };

            Plotly.newPlot('requestsChart', requestsData, requestsLayout, {responsive: true});

            // Price Category Chart
            var priceData = [{
                x: ['Budget<br>(<$75)', 'Economy<br>($75-100)', 'Standard<br>($100-125)', 'Premium<br>($125-150)', 'Luxury<br>(>$150)'],
                y: [10.2, 27.0, 41.4, 33.5, 49.2],
                type: 'bar',
                marker: {
                    color: '#f39c12'
                },
                text: ['10.2%', '27.0%', '41.4%', '33.5%', '49.2%'],
                textposition: 'outside'
            }];

            var priceLayout = {
                yaxis: { title: 'Cancellation Rate (%)' },
                height: 400,
                margin: { t: 30, b: 100, l: 60, r: 30 }
            };

            Plotly.newPlot('priceChart', priceData, priceLayout, {responsive: true});

            // Monthly Trends Chart
            var monthlyData1 = {
                x: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                y: [2.4, 25.4, 29.8, 36.4, 36.7, 40.3, 45.0, 37.9, 33.5, 35.3, 29.4, 13.2],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Cancellation Rate (%)',
                marker: {
                    color: '#e74c3c',
                    size: 8
                },
                line: {
                    color: '#e74c3c',
                    width: 3
                }
            };

            var monthlyLayout = {
                yaxis: { title: 'Cancellation Rate (%)' },
                height: 400,
                showlegend: true,
                margin: { t: 30, b: 60, l: 60, r: 30 }
            };

            Plotly.newPlot('monthlyChart', [monthlyData1], monthlyLayout, {responsive: true});

            // Monthly Stacked Chart
            var monthlyStacked1 = {
                x: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                y: [976, 1244, 1635, 1716, 1623, 1889, 1587, 2648, 3026, 3389, 2073, 2583],
                type: 'bar',
                name: 'Not Canceled',
                marker: {
                    color: '#3498db'
                }
            };

            var monthlyStacked2 = {
                x: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                y: [24, 424, 693, 984, 940, 1273, 1300, 1616, 1524, 1849, 864, 394],
                type: 'bar',
                name: 'Canceled',
                marker: {
                    color: '#e74c3c'
                }
            };

            var stackedLayout = {
                barmode: 'stack',
                yaxis: { title: 'Number of Bookings' },
                height: 400,
                margin: { t: 30, b: 60, l: 60, r: 30 }
            };

            Plotly.newPlot('monthlyStackedChart', [monthlyStacked1, monthlyStacked2], stackedLayout, {responsive: true});

            // Revenue Impact Chart
            var revenueData = [{
                x: ['Potential Revenue', 'Revenue Lost', 'Recoverable (10%)'],
                y: [11.09, 4.22, 0.42],
                type: 'bar',
                marker: {
                    color: ['#2ecc71', '#e74c3c', '#f39c12']
                },
                text: ['$11.09M', '$4.22M', '$0.42M'],
                textposition: 'outside'
            }];

            var revenueLayout = {
                yaxis: { title: 'Revenue (Millions $)' },
                height: 400,
                margin: { t: 30, b: 60, l: 60, r: 30 }
            };

            Plotly.newPlot('revenueChart', revenueData, revenueLayout, {responsive: true});

            console.log('‚úÖ Dashboard initialized successfully! All charts rendered.');
        }

        // Start initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDashboard);
        } else {
            // DOM already loaded, init immediately
            initDashboard();
        }
    </script>
</body>
</html>
